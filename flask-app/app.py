import requests
import json
from flask import Flask, jsonify, request, render_template

app = Flask(__name__)
app.config['TEMPLATES_AUTO_RELOAD'] = True


# @app.route('/')
# def hello_world():
#     return jsonify({"message": "Hello World!"})

@app.route('/')
def index_page():
    return render_template('input_data.html')


@app.route('/result', methods=['POST', 'GET'])
def predict_result():
    if request.method == 'POST':
        user_input = request.form.getlist('text')
        predict_item = user_input[0]
        # ---------------------------------------------------------------fraud transaction data in the real world---------------------------------------------------------------

        input_data=[-15.819178720771802,8.7759971528627,-22.8046864614815,11.864868080360699,-9.09236053189517,-2.38689320657655,-16.5603681078199,0.9483485947860579,-6.31065843275059,-13.0888909176936,9.81570317447819,-14.0560611837648,0.777191846436601,-13.7610179615936,-0.353635939812489,-7.9574472262599505,-11.9629542349435,-4.7805077876172,0.652498045264831,0.992278949261366,-2.35063374523783,1.03636187430048,1.13605073696052,-1.0434137405139001,-0.10892334328197999,0.657436778462222,2.1364244708551396,-1.41194537483904,-0.3492313067728856]
        input_data2=[-4.59944700208203,2.76253994253031,-4.6565298706326,5.201403067258941,-2.4703877121324704,-0.35761793034562106,-3.7671888274624004,0.0614664440276634,-1.83619986278079,-1.4706452575308,2.14393063330902,-5.83973605661705,0.15301163087673497,-6.17736456586248,-0.78541565373917,-4.5105227372106205,-10.3405128633486,-4.18117755349571,-0.376135682527478,-1.00065772232141,1.58148035659457,0.261332719512975,0.621415022135499,0.9941099269989819,-0.6878531060526639,-0.337531252843331,-1.61279104641522,1.23142473470435,0.019991953237284574]
        input_data3=[-5.34466537543542,-0.28576040816614195,-3.83561578178611,5.33704802681048,-7.60990870021268,3.8746680317393,1.2896299243891498,0.20174191680660103,-3.00353243733788,-3.9905513318107997,4.9860138036146795,-6.11638322304304,0.0423244061770454,-6.04339314434942,1.82140103177852,-4.7454624675489,-10.075645590727099,-3.6045960155148,1.43529381015392,-1.56216235780532,0.27601082218005396,1.3420445568958401,-1.0165786946483102,-0.0713612973880671,-0.33586933472687797,0.441044176004645,1.52061262049821,-1.11593680318009,5.252727144725221]
        input_data4=[-3.97593925787714,-1.24493887246577,-3.70741371980754,4.54477220840185,4.05067557270479,-3.40767861716595,-5.06311826997904,1.0070419967873299,-3.19015819504631,-4.25071651144568,4.182162368000459,-4.5636747378825095,1.18250275143465,-6.96497247579046,1.11533951405808,-4.9973316546668896,-6.41953891153561,-1.1835927397086599,3.56973257751778,2.1094026874149,1.05973707375805,-0.037394796398813,0.348707142883828,-0.162929482857413,0.410530958112178,-0.123612265343157,0.8774238514349849,0.667568429836307,-0.3200452775571385]
        input_data5=[-16.5265065691231,8.58497179585822,-18.649853185194498,9.50559351508723,-13.793818527095699,-2.8324042993974703,-16.701694296045,7.517343903709871,-8.50705863675898,-14.110184441545698,5.29923634963938,-10.8340064814734,1.67112025332681,-9.37385858364976,0.36080564163161705,-9.899246540806661,-19.2362923697613,-8.39855199494575,3.10173536885404,-1.51492343527852,1.19073869481428,-1.1276700090206102,-2.3585787697881,0.6734613289872371,-1.4136996745881998,-0.46276236139933,-2.01857524875161,-1.04280416970881,1.1028336180034406]
        input_data6=[-1.2126817006353101,-2.4848235304340602,-6.39718581511927,3.6705624478143597,-0.863375060980971,-1.8558547306372402,1.01773157976221,-0.54470377516891,-1.70337804998263,-3.73965947930309,1.73812401383737,-2.84444933585435,0.7658639612456719,-4.79973713485762,-0.0113354116437183,-2.69316808210374,-3.16695515760391,-1.06780011996093,-0.5591322022745949,2.9083739459278304,1.39687206274272,0.0920728715219574,-1.49288249863592,-0.20422739626528602,0.532510949154644,-0.29387110440687797,0.212663059827185,0.43109470797603494,4.984215675940347]
        input_data7=[-4.61721720415581,1.6956936534665599,-3.1143722007949104,4.32819855298178,-1.8732569908652699,-0.9899081355382628,-4.57726462658038,0.4722161584519,0.472016953377646,-5.576022636424151,4.80232276125089,-10.833164469314001,0.10430387569857501,-9.40542306160986,-0.80747786866047,-7.55234220350747,-9.8025617903912,-4.12062883466552,1.7405072903619598,-0.0390459343384186,0.481829697240067,0.14602305644594799,0.11703852754906499,-0.21756459883965998,-0.13877604370656302,-0.42445288106827506,-1.00204142597227,0.890780287970655,-0.34883149815349185]
        input_data8=[-14.724627011925302,7.875156792730469,-21.872317364456602,11.906169907890101,-8.34873369160876,-2.2628464196924503,-15.8334427819606,0.0778736741759969,-6.35683349086288,-13.2616517082667,10.0637897462894,-14.394766801672098,0.654888723464231,-14.2483158270781,-0.30536076140107105,-8.16163244506225,-12.2809648581754,-4.81858639342974,0.7197876821087908,0.996468755724792,-2.3623449275188397,1.09955729576975,1.0371994230130699,-1.03635934178889,-0.254776514154375,0.642343201018144,2.16112922373151,-1.40128201963858,-0.3492313067728856]
        input_data9=[-0.0754834663888726,1.8123545842275102,-2.5669808101696203,4.12754860722303,-1.62853157024518,-0.805895445766318,-3.39013454458215,1.01935326231828,-2.45125125188341,-3.55583492739064,4.31571103012142,-5.4798016767990605,-2.11550315600957,-5.588785576597401,0.280108069299552,-3.50723062361012,-7.4570949379312506,-2.32549168188332,-0.440434552920779,0.338598140549314,0.7943724518977819,0.27047123229786607,-0.143624140755259,0.0135659145316466,0.634203128800614,0.213693187250942,0.7736254666970891,0.38743405457201396,-0.33323896199713376]
        input_data10=[0.6677136413747979,3.0415023762052704,-5.84511195572955,5.967587038446701,0.213863332794167,-1.4629228111071202,-2.68876058357809,0.677763512400754,-3.44759589638668,-4.707570806112041,4.90581986504193,-5.20837397192841,0.532498380473016,-10.5440113995705,-1.3074187011067,-2.1335934878906997,-5.13308149079721,-1.06215078075411,-0.819371096333784,0.558424597641949,0.32976014592914,-0.941383471890008,-0.00607466234002341,-0.958925352213278,0.23929786494655103,-0.0673556786513241,0.8210475859116529,0.42617525159676595,-0.3262822920196818]

        # ---------------------------------------------------------------non-fraud transaction data in the real world---------------------------------------------------------------
        normal1=[-0.837949120123612,0.572034416184504,1.7930757088807499,-0.772884212419922,-0.3763594216172,-0.800408020447052,0.269930133925257,0.11027174416851401,-0.173140220242245,-0.18236293624958802,1.32785962878735,0.11003489902192,-1.09170019605614,0.38930213943357,0.458831220740396,0.445125710391633,-0.46116397349603006,0.307733165801651,0.425665345008645,0.0764387278779073,-0.020384993339451,-0.11302965162132099,-0.0470403842758406,0.554540534708213,-0.433271278070606,0.840266698246479,0.132161975562123,0.16694678466506302,-0.27330764995000384]
        normal2=[-0.8976500532987459,0.9534788377813409,0.750672046961177,0.28644524497871005,0.18244865603139804,0.0465588137676749,0.4543242444530661,0.0132619711954222,-0.0267188868218882,-0.146493166408569,-1.5672162240096799,0.34250290802338207,1.06444589466929,-0.34808374469285697,-0.0950509517885827,-0.373999167346269,-0.0910945428634547,-0.26872243219813297,1.4393920828831201,-0.0182783572508033,-0.139108022448921,-0.234293709211059,-0.220593090076212,-0.536815051985251,-0.39956862916762503,0.361749715175625,-0.542813766714331,-0.133270435232868,-0.22724969699583855]
        normal3=[-0.468455119071534,0.75783826629208,0.9089569774331372,0.0761276218692058,-0.6526253287475831,-0.4888034028919,0.118100430942057,0.49146138171735,-0.5459816073704861,-0.454382355430426,0.8884344481000692,0.440943092554209,-0.496110014379464,0.6645356773516071,0.12680130119419197,0.5745080163673879,-0.5171473970414561,0.751333006106328,-0.004652093985412871,-0.110432931942556,0.373621788809207,0.847549014731766,0.0104801288346785,0.35754318766381005,-0.270856656521284,0.40211853196257,-0.11829209059601,-0.0350529275273375,-0.1433298677850809]
        normal4=[0.0805578275430053,0.792623931665726,-0.13862707420125198,-0.956146491234333,0.9861537587064799,-0.17794201211991198,0.892562186946938,0.00725333791409832,-0.23295531030365302,-0.241772717224605,-0.19174685664346103,0.47744950721641294,0.13027564575263198,0.240770297635477,-1.02663932060752,0.417773783083559,-1.0531796202525698,0.0975443005040846,0.6126088607212989,0.00782414673299957,-0.27990834940269604,-0.6563028128819269,-0.0766289506940117,-1.10460625948045,-0.374709399079229,0.18776777982292303,0.242099001826993,0.0762347906510601,-0.33895622525446506]
        normal5=[-0.10432105653184401,1.07582529345891,-0.61092202141961,-0.813266960481453,1.14381282144508,-0.151805899735159,0.920977219429899,-0.0330391133820482,-0.107349796605515,0.17828198994613398,0.258898996255272,0.579919393175196,0.392751949081348,0.42945282591112705,-0.176688249857485,-0.0712999937182648,-1.0086126905039499,0.840877427659403,0.546980995837531,0.190229075428276,0.347504746105571,1.28617313715104,-0.182366787161031,0.13542936838077002,-0.6535625530130339,-0.230951924615517,0.608410228365014,0.375471540351839,-0.3388762635305863]

        # ------------------------------------post------------------------------------

        if predict_item != None:
            send_data = predict_item.split(",")
            send_data = list(map(lambda x: float(x[1:-1]), send_data))
        else:
            send_data = input_data
        resp = requests.post(
            'https://1fsubcbe75.execute-api.eu-west-3.amazonaws.com/dev/{proxy+}', data=json.dumps(send_data))
        output = json.loads(resp.content)
        normal_rate = output['result']['classifications'][0]['classes'][0]['score']
        fraud_rate = output['result']['classifications'][0]['classes'][1]['score']
        normal = float(normal_rate) * 100
        fraud = float(fraud_rate) * 100

        return render_template('index.html', normal=normal, fraud=fraud)


@app.route('/invocations', methods=['POST', 'GET'])
def invoke():
    input_data = [-15.819178720771802, 8.7759971528627, -22.8046864614815, 11.864868080360699, -9.09236053189517, -2.38689320657655, -16.5603681078199, 0.9483485947860579, -6.31065843275059, -13.0888909176936, 9.81570317447819, -14.0560611837648, 0.777191846436601, -13.7610179615936, -
                  0.353635939812489, -7.9574472262599505, -11.9629542349435, -4.7805077876172, 0.652498045264831, 0.992278949261366, -2.35063374523783, 1.03636187430048, 1.13605073696052, -1.0434137405139001, -0.10892334328197999, 0.657436778462222, 2.1364244708551396, -1.41194537483904, -0.3492313067728856]

    r = requests.post(
        'https://1fsubcbe75.execute-api.eu-west-3.amazonaws.com/dev/{proxy+}', data=json.dumps(input_data))
    # data = request.get_json(force=True)
    a = json.loads(r.content)
    return jsonify(a['result']['classifications'][0]['classes'][0]['score'], a['result']['classifications'][0]['classes'][1]['score'])


@app.route('/endpoint')
def get_data():
    return requests.get('https://1fsubcbe75.execute-api.eu-west-3.amazonaws.com/dev/{proxy+}').content


if __name__ == '__main__':
    app.config['TEMPLATES_AUTO_RELOAD'] = True
    app.run(debug=True, host='0.0.0.0', port=8080)
